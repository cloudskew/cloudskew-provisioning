parameters:
  # default values for any parameters that aren't specified.
  # please keep this list alphabetically sorted.
  azureSubscription: ''
  environment: ''
  
stages:

  - stage: build
    jobs:
      - job: build

  - stage: test
    jobs:
      - job: test

  - stage: deploy
    # don't execute this stage if triggered via pull-request.
    condition: and(succeeded(), ne(variables['build.reason'], 'PullRequest'))
    displayName: deploy to ${{parameters.environment}} environment
    jobs:
      - deployment: deploy
        displayName: deploy to ${{parameters.environment}} environment
        environment: ${{parameters.environment}}
        strategy:
          runOnce:
            deploy:
              steps:
                - task: Pulumi@1
                  displayName: 
                  inputs:
                    azureSubscription: ${{parameters.azureSubscription}}
                    command: 'preview'
                    stack: cloudskew/${{parameters.environment}}